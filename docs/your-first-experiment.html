<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Your First Experiment · Empirica</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="### Contents"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Your First Experiment · Empirica"/><meta property="og:type" content="website"/><meta property="og:url" content="https://empiricaly.github.io/index.html"/><meta property="og:description" content="### Contents"/><meta property="og:image" content="https://empiricaly.github.io/img/logo-white.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://empiricaly.github.io/img/logo-white.png"/><link rel="shortcut icon" href="/img/logo-transparent.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo-black.png" alt="Empirica"/><h2 class="headerTitleWithLogo">Empirica</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/quick-start" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/docs/api" target="_self">API</a></li><li class=""><a href="/help" target="_self">Help</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Getting Started</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul><li class="navListItem"><a class="navItem" href="/docs/quick-start">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/docs/usage">Usage</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/your-first-experiment">Your First Experiment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Community Demos</h3><ul><li class="navListItem"><a class="navItem" href="/docs/guess-the-correlation">Guess the Correlation</a></li><li class="navListItem"><a class="navItem" href="/docs/random-dot-motion">Random-Dot-Motion</a></li><li class="navListItem"><a class="navItem" href="/docs/room-assignment">Room Assignment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Reference</h3><ul><li class="navListItem"><a class="navItem" href="/docs/concepts">Concepts</a></li><li class="navListItem"><a class="navItem" href="/docs/lifecycle">Game Life Cycle</a></li><li class="navListItem"><a class="navItem" href="/docs/api">API</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docMainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Your First Experiment</h1></header><article><div><span><h3><a class="anchor" aria-hidden="true" id="contents"></a><a href="#contents" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contents</h3>
<ol>
<li><a href="#set-up">Getting Set Up with Empirica</a></li>
<li><a href="#configure-task">Configuring the task page</a></li>
<li><a href="#configure-content">Making task content configurable</a></li>
<li><a href="#social-information">Incorporating social play</a></li>
<li><a href="#conditions">Using treatments to modify the experiment</a></li>
<li><a href="#callbacks">Using callbacks to update player score</a></li>
<li><a href="#next-steps">Additional steps</a></li>
</ol>
<p><a id="set-up"></a></p>
<h2><a class="anchor" aria-hidden="true" id="10-getting-set-up-with-empirica"></a><a href="#10-getting-set-up-with-empirica" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.0 Getting Set Up With Empirica</h2>
<p>Although it won't do too much, Empirica works straight out of the box.  The first step to customizing your Empirica app is to launch a test game so you can see your edits in action.</p>
<ol>
<li>First, follow the <a href="quick-start">quick-start guide</a> to launch your app server.  Watch the terminal output to see your automatically generated admin login and password.</li>
<li>Then, visit your admin panel <a href="http://localhost:3000/admin">http://localhost:3000/admin</a> (if you are using a cloud server such as DigitalOcean, you may need to substitute <code>your server IP</code> for <code>localhost</code>)</li>
<li>Log in using the password generated in step 1.</li>
</ol>
<h4><a class="anchor" aria-hidden="true" id="11-configuring-your-app"></a><a href="#11-configuring-your-app" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.1 Configuring your app</h4>
<ol>
<li>Click &quot;configuration&quot; in the upper right corner to access app settings.   This is where you'll define all your experimental conditions.</li>
<li>Click <code>factors</code> in the menu bar at the top.  This is where you set the most basic parameters for your experiment.  The only default parameter is playerCount.  Add a new factor by clicking the <code>+</code> button.  Set the name to <code>One</code> and the value to <code>1</code>, then click <code>Create Factor Value</code></li>
<li>Click <code>treatments</code>.  This is where you combine factors to create an experimental condition.  Create a new treatment using the factor you just created and name whatever you want.</li>
<li>Click <code>Lobby Configurations</code> and create a new lobby configuration using the default settings.</li>
</ol>
<h4><a class="anchor" aria-hidden="true" id="12-creating-an-experiment-session"></a><a href="#12-creating-an-experiment-session" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.2 Creating an experiment session</h4>
<ol>
<li>Click <code>monitoring</code> in the upper right corner to toggle your admin panel from configuration to monitoring.  This is where you'll interact with all the Empirica features that have to do with actually running experiments.</li>
<li>Click <code>New Batch</code> in the batches panel, select the treatment you just created, and click <code>Create Batch</code>.</li>
<li>Press the play button (triangle) to start the batch.</li>
</ol>
<h4><a class="anchor" aria-hidden="true" id="13-testing-the-experiment-as-a-subject"></a><a href="#13-testing-the-experiment-as-a-subject" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1.3 Testing the experiment as a subject</h4>
<ol>
<li>Navigate to <a href="http://localhost:3000/">http://localhost:3000/</a> (or your custom IP)</li>
<li>Follow through the consent, identification (this would be, e.g., an MTurk ID), instruction pages, and attention check (you have to answer correctly)</li>
<li>You're running an experiment!  This is the default app---just a slider with 10 rounds of input.  We're going to edit that.</li>
</ol>
<p><a id="configure-task"></a></p>
<h2><a class="anchor" aria-hidden="true" id="20-configuring-the-task-page"></a><a href="#20-configuring-the-task-page" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.0 Configuring the task page</h2>
<p>The root file for displaying your subject interface is located at <code>&lt;your_app_directory&gt;\client\game\Round.jsx</code> .</p>
<p>By defualt, this is divided into two main components, <code>task</code> and <code>socialExposure</code>.  The <code>task</code> itself is composed of <code>taskStimulus</code> which contains the stimulus (e.g., a survey question--or in this example, an estimation task) and <code>taskResponse</code> which contains the input for users to response to the stimulus.</p>
<h4><a class="anchor" aria-hidden="true" id="21-adding-content-to-the-task-stimulus"></a><a href="#21-adding-content-to-the-task-stimulus" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.1 Adding content to the task stimulus</h4>
<p>Edit <code>taskStimulus.jsx</code> to the following.  Although Empirica is built on top of a sophisticated Meteor framework, all we have to interact with directly is standard Javascript with a ReactJS framework.</p>
<p>Notiece that your props passed into the React component include <code>round</code>,<code>stage</code>, and <code>player</code>.  These are your interface with Empirica, and allow you to both read and set data for the state of the experiment.</p>
<p>All we're doing here is adding an image and question to set up the display.  Later, we'll make the image path and question text configurable by reading in values from the <code>round</code> prop.</p>
<p><code>taskStimulus.jsx</code>:</p>
<pre><code class="hljs css language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">TaskStimulus</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> round<span class="token punctuation">,</span> stage<span class="token punctuation">,</span> player <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>

    <span class="token keyword">const</span> imagePath <span class="token operator">=</span> <span class="token string">"/experiment/images/candies.jpg"</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> questionText <span class="token operator">=</span> <span class="token string">"How many candies are in the jar?"</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>task-stimulus<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>task-image<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>imagePath<span class="token punctuation">}</span></span> <span class="token attr-name">height</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">"300px"</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>task-question<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span>Please answer the following question<span class="token punctuation">:</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
          How many candies are <span class="token keyword">in</span> the jar<span class="token operator">?</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="22-customizing-the-input-field-for-subject-responses"></a><a href="#22-customizing-the-input-field-for-subject-responses" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.2 Customizing the input field for subject responses</h4>
<p>All we're going to do in this section is change the input type from a slider to a numeric input box.  Because we're asking people to estimate the number of candies in a jar, we'll set the minimum value to zero.   We recommend adding additional form verification methods beyond the default to ensure a smooth user experience.  Note that if you do choose to use a slider input, we strongly recommend the Empirica slider, which is made with experimenters in mind--no default values that might create anchoring effects.</p>
<p>The complete final code for this file is available on GitHub [SHOULD BE DIRECT LINK].  Just update your <code>renderSlider</code> according to the following code and be sure to update the call in the main <code>render</code> method.</p>
<p>Notice that this method uses the <code>player</code> data to control the form input.  This player data is created with <code>player.round.set</code> in the <code>handleChange</code> method which is called every time the input is updated.</p>
<p>Every time <code>player.round.set</code> is called, this triggers a database call which the MongoDB server must route [IS THIS TRUE?].  If you need to reduce your server load, one option is to store this field value locally and only update the player value once the submit button is pressed.  We won't show that here--it can be accomplished with standard ReactJS--and note that this creates the risk that a users data will be lost if they exit the game unexpectedly.  In the present example, however, this feature will allow us to update subjects' social information in real time.</p>
<pre><code class="hljs css language-js">  <span class="token function">renderInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> player <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> player<span class="token punctuation">.</span>round<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">"number"</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">min</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span>
        <span class="token attr-name">required</span>
      <span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre>
<p>Because we changed the input type, we also need to update the <code>handleChange</code> method because input events return a different type of data than slider events:</p>
<pre><code class="hljs css language-js">  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> event <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> player <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    player<span class="token punctuation">.</span>round<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><a id="configure-content"></a></p>
<h2><a class="anchor" aria-hidden="true" id="30-making-it-easy-to-configure-stimulus-content"></a><a href="#30-making-it-easy-to-configure-stimulus-content" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.0 Making it easy to configure stimulus content</h2>
<p>The next step is to allow the experimenter to modify the stimulus without having to update the experiment code directly.   We'll accomplish this by creating a JSON data file <code>constants.js</code> that contains all the stimulus information, and then read that into the experiment via the <code>Empirica.gameInit</code> API method. [is API the right terminology?]</p>
<p>This all happens server-side, so you need to create this file in your <code>server</code> directory instead of your  <code>client</code> directory.</p>
<h4><a class="anchor" aria-hidden="true" id="31-creating-constantsjs-to-store-task-data-as-json-data"></a><a href="#31-creating-constantsjs-to-store-task-data-as-json-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.1 Creating constants.js to store task data as json data</h4>
<p><code>&lt;your_app_directory&gt;\server\game\constants.js</code></p>
<pre><code class="hljs css language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> taskData <span class="token operator">=</span> <span class="token punctuation">{</span>
  candies<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">"/experiment/images/candies.jpg"</span><span class="token punctuation">,</span>
    questionText<span class="token punctuation">:</span>
      <span class="token string">"The jar in this image contains nothing but standard M&amp;M's.  How many M&amp;M's are in the jar?"</span><span class="token punctuation">,</span>
    correctAnswer<span class="token punctuation">:</span> <span class="token number">797</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  survey<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    questionText<span class="token punctuation">:</span>
      <span class="token string">"A 2014 survey asked Americans whether science and technology make our lives better (easier, healthier, more comfortable).  What percentage of respondents agreed that science and technology are making our lives better?"</span><span class="token punctuation">,</span>
    correctAnswer<span class="token punctuation">:</span> <span class="token number">80.5</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>We're not actually going to use the <code>correctAnwser</code> value in this demo, but if you include all relevant data in your experiment then it life is a little easier when you download your data for analysis.</p>
<h4><a class="anchor" aria-hidden="true" id="32-using-data-from-constantsjs-in-the-game-initiation"></a><a href="#32-using-data-from-constantsjs-in-the-game-initiation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.2 Using data from constants.js in the game initiation</h4>
<p>Next, we need to incorporate this value in the <code>Empirica.gameInit</code> API method.  This method runs in
<code>&lt;your_app_directory&gt;\server\game\main.js</code>.</p>
<p>First, we import the <code>constants.js</code> data with  <code>import {taskData} from './constants';</code> added to the head of <code>main.js</code>.</p>
<p>We're also going to update  this method to randomly assign each player a set of 'neighbors' to follow.  We'll use this information when we update <code>socialExposure.jsx</code>.</p>
<p>Note also that these examples make use of <a href="http://underscorejs.org">underscore.js</a> a library of convenient javascript tools.</p>
<p><code>main.js</code></p>
<pre><code class="hljs css language-js"><span class="token keyword">import</span> Empirica <span class="token keyword">from</span> <span class="token string">"meteor/empirica:core"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">"./callbacks.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./bots.js"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>taskData<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>

<span class="token comment">// gameInit is where the structure of a game is defined.</span>
<span class="token comment">// Just before every game starts, once all the players needed are ready, this</span>
<span class="token comment">// function is called with the treatment and the list of players.</span>
<span class="token comment">// You must then add rounds and stages to the game, depending on the treatment</span>
<span class="token comment">// and the players. You can also get/set initial values on your game, players,</span>
<span class="token comment">// rounds and stages (with get/set methods), that will be able to use later in</span>
<span class="token comment">// the game.</span>
Empirica<span class="token punctuation">.</span><span class="token function">gameInit</span><span class="token punctuation">(</span>game <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Establish node list</span>
  <span class="token keyword">const</span> nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> game<span class="token punctuation">.</span>players<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  game<span class="token punctuation">.</span>players<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>player<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    player<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"avatar"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`/avatars/jdenticon/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>player<span class="token punctuation">.</span>_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    player<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Give each player a nodeId</span>
    player<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"nodeId"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Assign each node as a neighbor with probability 0.5</span>
    <span class="token keyword">const</span> networkNeighbors <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    player<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"neighbors"</span><span class="token punctuation">,</span> networkNeighbors<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  _<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>taskData<span class="token punctuation">,</span> <span class="token punctuation">(</span>task<span class="token punctuation">,</span> taskName<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> round <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">addRound</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        taskName<span class="token punctuation">:</span> taskName<span class="token punctuation">,</span>
        questionText<span class="token punctuation">:</span> task<span class="token punctuation">.</span>questionText<span class="token punctuation">,</span>
        imagePath<span class="token punctuation">:</span> task<span class="token punctuation">.</span>pathath<span class="token punctuation">,</span>
        correctAnswer<span class="token punctuation">:</span> task<span class="token punctuation">.</span>correctAnswer
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    round<span class="token punctuation">.</span><span class="token function">addStage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">"response"</span><span class="token punctuation">,</span>
      displayName<span class="token punctuation">:</span> <span class="token string">"Response"</span><span class="token punctuation">,</span>
      durationInSeconds<span class="token punctuation">:</span> <span class="token number">120</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="33-incorporating-dynamic-round-data-in-taskjsx"></a><a href="#33-incorporating-dynamic-round-data-in-taskjsx" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.3 Incorporating dynamic round data in task.jsx</h4>
<p>Finally, we're ready to incorporate our new configurable task data into task.jsx.  We'll do this in <code>taskStimulus.jsx</code></p>
<p>It's easy!   All we do is change the value of the constants to pull dynamically with <code>round.get()</code> instead of setting them manually:</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> imagePath <span class="token operator">=</span> round<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"imagePath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> questionText <span class="token operator">=</span> round<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"questionText"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We also add logic so that we only display an image of a path is given:</p>
<pre><code class="hljs css language-js"><span class="token punctuation">{</span>imagePath<span class="token operator">==</span>undefined <span class="token operator">?</span> <span class="token string">""</span> <span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>imagePath<span class="token punctuation">}</span></span> <span class="token attr-name">height</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">"300px"</span><span class="token punctuation">}</span></span><span class="token punctuation">/></span></span><span class="token punctuation">}</span>
</code></pre>
<p><a id="social-information"></a></p>
<h2><a class="anchor" aria-hidden="true" id="40-adding-social-information-to-the-subject-experience"></a><a href="#40-adding-social-information-to-the-subject-experience" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.0 Adding social information to the subject experience</h2>
<p>Social information is included in the default Empirica template via  <code>SocialExposure.jsx</code>.  However, nothing will show if we don't have any other players!</p>
<p>The first thing to do is create a multi-player game by adding a new factor value to playerCount (following the same procedure as above) with more than one player, then creating a new treatment and a new batch.  You can then launch the Empirica app multiple times in the same web browser by clicking &quot;New Player&quot; in the header tab.   The app will start once the required number of players has entered the lobby.</p>
<p>In this example we're going to modify the default behavior so that (a) the social information only shows after subjects have entered their initial respnose, and (b) social information shows only for a subject's network neighbors.</p>
<h4><a class="anchor" aria-hidden="true" id="41-showing-social-information-only-after-a-player-enters-their-initial-response"></a><a href="#41-showing-social-information-only-after-a-player-enters-their-initial-response" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.1 Showing social information only after a player enters their initial response</h4>
<p>Within each <code>round</code> are multiple <code>stages</code>.   We can add more stages by returning to the <code>Empirica.gameInit</code> method and adding the following:</p>
<pre><code class="hljs css language-js">round<span class="token punctuation">.</span><span class="token function">addStage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">"social"</span><span class="token punctuation">,</span>
    displayName<span class="token punctuation">:</span> <span class="token string">"Social Information"</span><span class="token punctuation">,</span>
    durationInSeconds<span class="token punctuation">:</span> <span class="token number">120</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We can access the stage information (including the name) within the app, so we're going to modify <code>Round.jsx</code> to display the <code>SocialExposure</code> component only when <code>stage.name===&quot;social&quot;</code>:</p>
<pre><code class="hljs css language-js"><span class="token punctuation">{</span>stage<span class="token punctuation">.</span>name<span class="token operator">==</span><span class="token string">"social"</span> <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SocialExposure</span> <span class="token attr-name">stage</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>stage<span class="token punctuation">}</span></span> <span class="token attr-name">player</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>player<span class="token punctuation">}</span></span> <span class="token attr-name">game</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>game<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">}</span>
</code></pre>
<p>Finally, we'll modify <code>SocialExposure.jsx</code> to only show information for players listed in <code>player.get(&quot;neighbors&quot;)</code> by replacing the declaration for <code>const otherPlayers</code> with</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> otherPlayers <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>players<span class="token punctuation">,</span> p <span class="token operator">=></span> p<span class="token punctuation">.</span>_id <span class="token operator">!=</span> player<span class="token punctuation">.</span>_id <span class="token operator">&amp;&amp;</span> player<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"neighbors"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"nodeId"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We're also going to remove the slider element, since we are not using that in this example, and just print the number:</p>
<pre><code class="hljs css language-js">  <span class="token function">renderSocialInteraction</span><span class="token punctuation">(</span>otherPlayer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> otherPlayer<span class="token punctuation">.</span>round<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alter<span class="token punctuation">"</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>otherPlayer<span class="token punctuation">.</span>_id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>otherPlayer<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"avatar"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>profile-avatar<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        Guess<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">}</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>This simple feature shows just how cool and powerful Empirica can be.  Just by virtue of storing user information with <code>player.set()</code> and displaying that information in the <code>SocialExposure</code> component, the subject interface is automatically updated.   This is due to the way ReactJS works with Meteor:  any time a piece of information passed as one of the props is updated, then the display re-renders to show the new information.</p>
<p><a id="conditions"></a></p>
<h2><a class="anchor" aria-hidden="true" id="50-using-treatment-factors-to-modify-the-game-features"></a><a href="#50-using-treatment-factors-to-modify-the-game-features" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5.0  Using treatment factors to modify the game features</h2>
<p>One of the key features of Empirica is the ability to thin like a scientist--control your app with experimental conditions.   To show how this works we'll just add one factor, allowing us to modify the stage length without changing the code.</p>
<p>First, we add the new factor through the admin panel by navigating to the factors interface and clicking &quot;New Factor&quot;.  You can archive your earlier treatment(s) so they don't clutter up the interface.  You'll always be able to unarchive these if necessary.</p>
<p>Then, add a new value, make a new treatment, and create a new batch.</p>
<p>We use this treatment information in the <code>Empirica.gameInit</code> method by simply changing the definition in <code>server\main.js</code> to be <code>durationInSeconds: game.treatment.stageLength</code> for both stages.</p>
<p><a id="callbacks"></a></p>
<h2><a class="anchor" aria-hidden="true" id="60-calculating-player-score-with-callbacks"></a><a href="#60-calculating-player-score-with-callbacks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6.0 Calculating player score with callbacks</h2>
<p>Empirica provides a set of methods that will run at the start and end of each round and stage.  These can be found in <code>&lt;your_app_directory&gt;\server\callbacks.js</code>.</p>
<p>By default, the score is equal to the total sum of responses, but this is not very informative.  We'll modify this to show percentage of error subtracted from 1:</p>
<pre><code class="hljs css language-js"><span class="token comment">// onRoundEnd is triggered after each round.</span>
<span class="token comment">// It receives the same options as onGameEnd, and the round that just ended.</span>
Empirica<span class="token punctuation">.</span><span class="token function">onRoundEnd</span><span class="token punctuation">(</span><span class="token punctuation">(</span>game<span class="token punctuation">,</span> round<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  game<span class="token punctuation">.</span>players<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>player <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> player<span class="token punctuation">.</span>round<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> prevScore <span class="token operator">=</span> player<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newScore <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> value <span class="token operator">/</span> round<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"correctAnswer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newScore <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> newScore <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    player<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">,</span> prevScore <span class="token operator">+</span> newScore<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><a id="next-steps"></a></p>
<h2><a class="anchor" aria-hidden="true" id="70-next-steps-and-future-work"></a><a href="#70-next-steps-and-future-work" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7.0 Next steps and future work</h2>
<p>In this tutorial, we have created a simple that prompts subjects to complete numeric estimation tasks and allows them to revise their answers while observing the responses of other subjects.</p>
<p>Right now, this app ONLY works for social conditions--if you don't have any neighbors, things will look a bit weird because the stage name is called &quot;Social Information&quot; and there are no instructions.</p>
<p>Here are some examples of how we can use Empirica features to expand the functionality of this experiment:</p>
<ul>
<li>Add logic to use different stage names for social and non-social conditions</li>
<li>Add configurable task instructions to the constants.js that say things like &quot;Please answer the question, you will have a chance to revise your answer&quot; and &quot;Please revise your answer&quot;</li>
<li>Add a factor &quot;questionSet&quot; that takes a comma-separated list of question identifiers, and uses only those questions.  This allows different treatments to use different conditions, based on the same constants.js file.</li>
<li>If you want to use more complex network structures, you could store those in a json format and import them in main.js</li>
</ul>
<p>There are also several very basic features from the Intro and Outro we haven't touched yet that you'll need to update</p>
<ul>
<li>the consent form</li>
<li>the instructions pages</li>
<li>the attention check</li>
<li>the Exit Survey and Thank You page</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/usage"><span class="arrow-prev">← </span><span>Previous</span></a><a class="docs-next button" href="/docs/guess-the-correlation"><span>Next</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav docOnPageNav"><ul class="toc-headings"><li><a href="#10-getting-set-up-with-empirica">1.0 Getting Set Up With Empirica</a></li><li><a href="#20-configuring-the-task-page">2.0 Configuring the task page</a></li><li><a href="#30-making-it-easy-to-configure-stimulus-content">3.0 Making it easy to configure stimulus content</a></li><li><a href="#40-adding-social-information-to-the-subject-experience">4.0 Adding social information to the subject experience</a></li><li><a href="#50-using-treatment-factors-to-modify-the-game-features">5.0 Using treatment factors to modify the game features</a></li><li><a href="#60-calculating-player-score-with-callbacks">6.0 Calculating player score with callbacks</a></li><li><a href="#70-next-steps-and-future-work">7.0 Next steps and future work</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo-white.png" alt="Empirica" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quick-start.html">Getting Started</a></div><div><h5>Community</h5><a href="https://twitter.com/empirica_ly" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/empiricaly">GitHub</a><a class="github-button" href="https://github.com/empiricaly/meteor-empirica-core" data-icon="octicon-star" data-count-href="/empiricaly/meteor-empirica-core/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2018 Empirica</section></footer></div></body></html>